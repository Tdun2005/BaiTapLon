<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Th√™m thi·∫øt b·ªã - Qu·∫£n l√Ω thi·∫øt b·ªã</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 40px 20px;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(270deg, #a1c4fd, #c2e9fb, #fbc2eb, #a6c1ee);
      background-size: 1000% 1000%;
      animation: sparkle 15s ease infinite;
      color: #333;
      min-height: 100vh;
    }

    @keyframes sparkle {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    h1 {
      text-align: center;
      font-size: 34px;
      margin-bottom: 35px;
      color: #222;
    }

    form {
      max-width: 750px;
      margin: 0 auto;
      background: white;
      padding: 35px;
      border-radius: 16px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }

    label {
      display: block;
      margin: 16px 0 10px;
      font-weight: bold;
      font-size: 18px;
    }

    input, select, textarea {
      width: 100%;
      padding: 16px;
      font-size: 18px;
      border: 1px solid #ccc;
      border-radius: 10px;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    .buttons {
      margin-top: 35px;
      display: flex;
      justify-content: space-between;
      gap: 20px;
    }

    .buttons button, .buttons a {
      flex: 1;
      padding: 16px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 10px;
      border: none;
      text-align: center;
      text-decoration: none;
      transition: 0.3s ease;
    }

    .add-btn {
      background: linear-gradient(to right, #00c6ff, #0072ff);
      color: white;
    }

    .add-btn:hover {
      background: linear-gradient(to right, #0072ff, #00c6ff);
    }

    .back-btn {
      background: #6c757d;
      color: white;
    }

    .back-btn:hover {
      background: #343a40;
    }

    #customStatus, #customType {
      display: none;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Th√™m thi·∫øt b·ªã</h1>
  <form id="addDeviceForm">

    <label for="deviceId">ID thi·∫øt b·ªã</label>
    <input type="number" id="deviceId" min="1" required placeholder="VD: 1, 2, 3...">

    <label for="deviceName">T√™n thi·∫øt b·ªã</label>
    <input type="text" id="deviceName" required placeholder="Nh·∫≠p t√™n thi·∫øt b·ªã">

    <label for="deviceType">Lo·∫°i thi·∫øt b·ªã</label>
    <select id="deviceType" onchange="handleTypeChange()" required>
      <option value="">-- Ch·ªçn lo·∫°i thi·∫øt b·ªã --</option>
      <option>M√°y t√≠nh</option>
      <option>M√°y chi·∫øu</option>
      <option>TV th√¥ng minh</option>
      <option>B·∫£ng t∆∞∆°ng t√°c</option>
      <option>Router WiFi</option>
      <option>Camera gi√°m s√°t</option>
      <option>M√°y in</option>
      <option>Kh√°c</option>
    </select>
    <input type="text" id="customType" placeholder="Nh·∫≠p lo·∫°i thi·∫øt b·ªã c·ª• th·ªÉ...">

    <label for="deviceStatus">T√¨nh tr·∫°ng thi·∫øt b·ªã</label>
    <select id="deviceStatus" onchange="handleStatusChange()" required>
      <option value="">-- Ch·ªçn t√¨nh tr·∫°ng --</option>
      <option>M·ªõi</option>
      <option>C≈©</option>
      <option>Kh√°c</option>
    </select>
    <input type="text" id="customStatus" placeholder="Nh·∫≠p t√¨nh tr·∫°ng kh√°c...">

    <label for="addedDate">Ng√†y th√™m</label>
    <input type="date" id="addedDate" required>

    <label for="description">Mi√™u t·∫£</label>
    <textarea id="description" placeholder="Nh·∫≠p mi√™u t·∫£ chi ti·∫øt..."></textarea>

    <div class="buttons">
      <button type="submit" class="add-btn">Th√™m thi·∫øt b·ªã</button>
      <a href="dashboard.html" class="back-btn">‚Üê Quay l·∫°i</a>
    </div>
  </form>

  <script>
    function handleStatusChange() {
      const status = document.getElementById('deviceStatus').value;
      const customStatus = document.getElementById('customStatus');
      customStatus.style.display = (status === 'Kh√°c') ? 'block' : 'none';
    }

    function handleTypeChange() {
      const type = document.getElementById('deviceType').value;
      const customType = document.getElementById('customType');
      customType.style.display = (type === 'Kh√°c') ? 'block' : 'none';
    }

    document.getElementById('addDeviceForm').addEventListener('submit', async function (event) {
      event.preventDefault();

      const id = parseInt(document.getElementById('deviceId').value);
      const name = document.getElementById('deviceName').value.trim();
      let type = document.getElementById('deviceType').value;
      if (type === 'Kh√°c') {
        type = document.getElementById('customType').value.trim();
      }

      let status = document.getElementById('deviceStatus').value;
      if (status === 'Kh√°c') {
        status = document.getElementById('customStatus').value.trim();
      }

      const date = document.getElementById('addedDate').value;
      const desc = document.getElementById('description').value.trim();

      if (!id || !name || !type || !status || !date) {
        alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
        return;
      }

      const newDevice = { id, name, type, status, date, desc };

      try {
        const res = await fetch('http://localhost:2704/api/devices', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(newDevice)
        });

        const data = await res.json();
        if (data.success) {
          alert("üéâ Th√™m thi·∫øt b·ªã th√†nh c√¥ng!");
          this.reset();
          document.getElementById('customStatus').style.display = 'none';
          document.getElementById('customType').style.display = 'none';
        } else {
          alert("‚ùå L·ªói: " + data.message);
        }
      } catch (err) {
        console.error("L·ªói g·ªçi API:", err);
        alert("üö´ Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi server.");
      }
    });
  </script>
</body>
</html>
